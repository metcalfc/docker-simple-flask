version: "3.8"
services:

  frontend:
    build: app
    x-aws-pull_credentials: arn:aws:secretsmanager:us-west-2:175142243308:secret:DockerHubAccessToken-8cRLae 
    image: metcalfc/timestamper
    ports:
      - "5000:5000"
    secrets:
      - db_password
    depends_on:
      - backend

  backend:
    image: redis:alpine
    volumes:
      - "redis:/data"
    command: ["sh", "-c", "redis-server --requirepass \"$$(cat /run/secrets/db_password)\""]
    secrets:
      - db_password

secrets:
  db_password:
    file: secret.txt

volumes:
  redis:
